<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.kies.sgsc.dao.base.ProcesRiskAnayRtmeLoadMinDAO">

	<insert id="insertProcesRiskAnayRtmeLoadMin">
		<![CDATA[
			INSERT INTO th_proces_risk_anay_rtme_load_min (
				anys_ymdhi
				,anys_sys_cd
				,risk_type_id
				,procs_id
				,risk_step_cd
				,risk_step_lvl
				,risk_num
				,risk_unit
				,risk_val
			) VALUES (
				#{anys_ymdhi}
				,#{anys_sys_cd}
				,#{risk_type_id}
				,#{procs_id}
				,#{risk_step_cd}
				,#{risk_step_lvl}
				,#{risk_num}
				,#{risk_unit}
				,#{risk_val}
			)
		]]>
	</insert> 

	<delete id="deleteProcesRiskAnayRtmeLoadMin">
		<![CDATA[
			DELETE FROM th_proces_risk_anay_rtme_load_min
			WHERE anys_ymdhi = #{anys_ymdhi}
			AND anys_sys_cd = #{anys_sys_cd}
			AND risk_type_id = #{risk_type_id}
			AND procs_id = #{procs_id}
		]]>
	</delete>

	<update id="updateProcesRiskAnayRtmeLoadMin">
		<![CDATA[
			UPDATE th_proces_risk_anay_rtme_load_min
			SET
		]]>
			<if test='anys_ymdhi != null and anys_ymdhi != ""'>anys_ymdhi = #{anys_ymdhi}</if>
			<if test='anys_sys_cd != null and anys_sys_cd != ""'>,anys_sys_cd = #{anys_sys_cd}</if>
			<if test='risk_type_id != null and risk_type_id != ""'>,risk_type_id = #{risk_type_id}</if>
			<if test='procs_id != null and procs_id != ""'>,procs_id = #{procs_id}</if>
			<if test='risk_step_cd != null and risk_step_cd != ""'>,risk_step_cd = #{risk_step_cd}</if>
			<if test='risk_step_lvl != null and risk_step_lvl != ""'>,risk_step_lvl = #{risk_step_lvl}</if>
			<if test='risk_num != null and risk_num != ""'>,risk_num = #{risk_num}</if>
			<if test='risk_unit != null and risk_unit != ""'>,risk_unit = #{risk_unit}</if>
			<if test='risk_val != null and risk_val != ""'>,risk_val = #{risk_val}</if>
		<![CDATA[
			WHERE anys_ymdhi = #{anys_ymdhi}
			AND anys_sys_cd = #{anys_sys_cd}
			AND risk_type_id = #{risk_type_id}
			AND procs_id = #{procs_id}
		]]>
	</update>

	<select id="listProcesRiskAnayRtmeLoadMin_anys_ymdhi" resultType="hashmap">
		<![CDATA[
			SELECT
				anys_ymdhi
				,anys_sys_cd
				,risk_type_id
				,procs_id
				,risk_step_cd
				,risk_step_lvl
				,risk_num
				,risk_unit
				,risk_val
			FROM th_proces_risk_anay_rtme_load_min
			WHERE anys_ymdhi = #{anys_ymdhi}
		]]>
	</select>

	<select id="listProcesRiskAnayRtmeLoadMin_anys_sys_cd" resultType="hashmap">
		<![CDATA[
			SELECT
				anys_ymdhi
				,anys_sys_cd
				,risk_type_id
				,procs_id
				,risk_step_cd
				,risk_step_lvl
				,risk_num
				,risk_unit
				,risk_val
			FROM th_proces_risk_anay_rtme_load_min
			WHERE anys_ymdhi = #{anys_ymdhi}
			AND anys_sys_cd = #{anys_sys_cd}
		]]>
	</select>

	<select id="listProcesRiskAnayRtmeLoadMin_risk_type_id" resultType="hashmap">
		<![CDATA[
			SELECT
				anys_ymdhi
				,anys_sys_cd
				,risk_type_id
				,procs_id
				,risk_step_cd
				,risk_step_lvl
				,risk_num
				,risk_unit
				,risk_val
			FROM th_proces_risk_anay_rtme_load_min
			WHERE anys_ymdhi = #{anys_ymdhi}
			AND anys_sys_cd = #{anys_sys_cd}
			AND risk_type_id = #{risk_type_id}
		]]>
	</select>

	<select id="getProcesRiskAnayRtmeLoadMin_procs_id" resultType="hashmap">
		<![CDATA[
			SELECT
				anys_ymdhi
				,anys_sys_cd
				,risk_type_id
				,procs_id
				,risk_step_cd
				,risk_step_lvl
				,risk_num
				,risk_unit
				,risk_val
			FROM th_proces_risk_anay_rtme_load_min
			WHERE anys_ymdhi = #{anys_ymdhi}
			AND anys_sys_cd = #{anys_sys_cd}
			AND risk_type_id = #{risk_type_id}
			AND procs_id = #{procs_id}
		]]>
	</select>

	<select id="listProcesRiskAnayRtmeLoadMin" resultType="hashmap">
		<![CDATA[
			SELECT
				anys_ymdhi
				,anys_sys_cd
				,risk_type_id
				,procs_id
				,risk_step_cd
				,risk_step_lvl
				,risk_num
				,risk_unit
				,risk_val
			FROM th_proces_risk_anay_rtme_load_min
			WHERE 1=1
		]]>
		<if test='anys_ymdhi != null and anys_ymdhi != ""'>AND anys_ymdhi = #{anys_ymdhi}</if>
		<if test='anys_sys_cd != null and anys_sys_cd != ""'>AND anys_sys_cd = #{anys_sys_cd}</if>
		<if test='risk_type_id != null and risk_type_id != ""'>AND risk_type_id = #{risk_type_id}</if>
		<if test='procs_id != null and procs_id != ""'>AND procs_id = #{procs_id}</if>
		<if test='risk_step_cd != null and risk_step_cd != ""'>AND risk_step_cd = #{risk_step_cd}</if>
		<if test='risk_step_lvl != null and risk_step_lvl != ""'>AND risk_step_lvl = #{risk_step_lvl}</if>
		<if test='risk_num != null and risk_num != ""'>AND risk_num = #{risk_num}</if>
		<if test='risk_unit != null and risk_unit != ""'>AND risk_unit = #{risk_unit}</if>
		<if test='risk_val != null and risk_val != ""'>AND risk_val = #{risk_val}</if>
	</select>

	<select id="pageProcesRiskAnayRtmeLoadMin" resultType="hashmap">
		<![CDATA[
			SELECT * FROM ( 
				SELECT 
					@rownum:=@rownum+1 RO, 
					A.* 
				FROM 
				(
					SELECT
						anys_ymdhi
						,anys_sys_cd
						,risk_type_id
						,procs_id
						,risk_step_cd
						,risk_step_lvl
						,risk_num
						,risk_unit
						,risk_val
					FROM th_proces_risk_anay_rtme_load_min
					WHERE 1 = 1 
		]]>
					<if test='anys_ymdhi != null and anys_ymdhi != ""'> AND anys_ymdhi = #{anys_ymdhi}</if>
					<if test='anys_sys_cd != null and anys_sys_cd != ""'> AND anys_sys_cd = #{anys_sys_cd}</if>
					<if test='risk_type_id != null and risk_type_id != ""'> AND risk_type_id = #{risk_type_id}</if>
					<if test='procs_id != null and procs_id != ""'> AND procs_id = #{procs_id}</if>
					<if test='risk_step_cd != null and risk_step_cd != ""'> AND risk_step_cd = #{risk_step_cd}</if>
					<if test='risk_step_lvl != null and risk_step_lvl != ""'> AND risk_step_lvl = #{risk_step_lvl}</if>
					<if test='risk_num != null and risk_num != ""'> AND risk_num = #{risk_num}</if>
					<if test='risk_unit != null and risk_unit != ""'> AND risk_unit = #{risk_unit}</if>
					<if test='risk_val != null and risk_val != ""'> AND risk_val = #{risk_val}</if>
		<![CDATA[
					ORDER BY update_date DESC
				) A,
				(SELECT @rownum:=0) TMP
			) A
			LIMIT  ${startRow},${endRow}
		]]>
	</select>

	<select id="countProcesRiskAnayRtmeLoadMin" resultType="int">
		<![CDATA[
			SELECT count(1)  
			FROM th_proces_risk_anay_rtme_load_min
			WHERE 1 = 1 
		]]>
		<if test='anys_ymdhi != null and anys_ymdhi != ""'>AND anys_ymdhi = #{anys_ymdhi}</if>
		<if test='anys_sys_cd != null and anys_sys_cd != ""'>AND anys_sys_cd = #{anys_sys_cd}</if>
		<if test='risk_type_id != null and risk_type_id != ""'>AND risk_type_id = #{risk_type_id}</if>
		<if test='procs_id != null and procs_id != ""'>AND procs_id = #{procs_id}</if>
		<if test='risk_step_cd != null and risk_step_cd != ""'>AND risk_step_cd = #{risk_step_cd}</if>
		<if test='risk_step_lvl != null and risk_step_lvl != ""'>AND risk_step_lvl = #{risk_step_lvl}</if>
		<if test='risk_num != null and risk_num != ""'>AND risk_num = #{risk_num}</if>
		<if test='risk_unit != null and risk_unit != ""'>AND risk_unit = #{risk_unit}</if>
		<if test='risk_val != null and risk_val != ""'>AND risk_val = #{risk_val}</if>
	</select>
	
	<!-- 시뷸레이션 집계  -->
	<select id="listEqmtLoadMinSimulRiskNum" resultType="hashmap">
		<![CDATA[
			SELECT 
				a.anys_ymdhi
				,a.anys_sys_cd
				,a.risk_type_id
				,b.procs_id
				,c.use_yn
				,c.grp_cal_cd
				,a.risk_unit	
				,case when c.use_yn='Y' then
					case when c.GRP_CAL_CD ='MAX' then					    
						max(concat(lpad(risk_num,5,'0'), ':', a.risk_step_lvl , ':', a.risk_step_cd))
					else
						Min(concat(lpad(risk_num,5,'0'), ':', a.risk_step_lvl , ':', a.risk_step_cd))
					end	
				else
					case when c.GRP_CAL_CD ='MAX' then					    
						max(case when IFNULL(a.RISK_VAL,'') ='' then c.DEFAULT_VAL ELSE a.RISK_VAL end)
					else
						Min(case when IFNULL(a.RISK_VAL,'') ='' then c.DEFAULT_VAL ELSE a.RISK_VAL end)
					end
				end	 risk_rate
				
			FROM th_eqmt_risk_anay_rtme_load_min a, tb_equipment b, tc_risk_type c
			WHERE a.EQMT_ID = b.EQMT_ID
			AND a.RISK_TYPE_ID = c.RISK_TYPE_ID
			AND a.anys_ymdhi = #{anys_ymdhi}
			GROUP BY a.anys_ymdhi
				,a.anys_sys_cd
				,a.risk_type_id
				,b.procs_id
				,c.use_yn
				,c.grp_cal_cd
				,a.risk_unit
		]]>
	</select>
	
</mapper>